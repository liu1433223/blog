<!-- templates/stats_monitor.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>阅读统计监控面板</title>
    <style>
        .dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }

        .stat-label {
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
<div class="dashboard">
    <div class="card">
        <h2>缓存命中率</h2>
        <div id="hit-rate" class="stat-value">--%</div>
        <div class="stat-label">过去24小时</div>
    </div>

    <div class="card">
        <h2>总阅读量</h2>
        <div id="total-reads" class="stat-value">--</div>
        <div class="stat-label">所有文章</div>
    </div>

    <div class="card">
        <h2>用户人次</h2>
        <div id="total-users" class="stat-value">--</div>
        <div class="stat-label">所有文章</div>
    </div>

    <div class="card">
        <h2>热门文章</h2>
        <div id="top-articles-count" class="stat-value">--</div>
        <div class="stat-label">热门文章数量</div>
    </div>

    <div class="card">
        <h2>热门用户</h2>
        <div id="top-users-count" class="stat-value">--</div>
        <div class="stat-label">热门用户数量</div>
    </div>

    <div class="card">
        <h2>Redis状态</h2>
        <div id="redis-keys" class="stat-value">--</div>
        <div class="stat-label">Keys数量</div>
    </div>
</div>

<script>
    // 更新监控面板
    async function updateDashboard() {
        try {
            // 获取缓存统计数据
            const cacheStatsResponse = await fetch('/stats/cache-stats/');
            const cacheData = await cacheStatsResponse.json();

            // 获取总阅读量数据
            const totalReadsResponse = await fetch('/stats/total-reads/');
            const totalReadsData = await totalReadsResponse.json();

            // 更新缓存命中率
            document.getElementById('hit-rate').textContent = cacheData.hit_rate;

            // 更新Redis状态
            document.getElementById('redis-keys').textContent = cacheData.total_keys;

            // 更新总阅读量
            document.getElementById('total-reads').textContent = totalReadsData.total_reads.toLocaleString();

            // 更新用户人次
            document.getElementById('total-users').textContent = totalReadsData.total_users.toLocaleString();

            // 更新热门文章数量
            document.getElementById('top-articles-count').textContent = cacheData.top_articles_count || '--';

            // 更新热门用户数量
            document.getElementById('top-users-count').textContent = totalReadsData.user_read_distribution_count || '--';

        } catch (error) {
            console.error('监控数据获取失败:', error);
        }
    }

    // 每30秒更新一次数据
    setInterval(updateDashboard, 30000);
    updateDashboard(); // 初始化
</script>
</body>
</html>
